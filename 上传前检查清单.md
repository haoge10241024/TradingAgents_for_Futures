# GitHub上传前检查清单

在将项目上传到GitHub之前，请逐项检查以下内容，确保不泄露敏感信息。

## ✅ 检查清单

### 1. API密钥检查

- [ ] **已删除** `config.py`文件（包含真实API密钥）
- [ ] **已删除** `期货TradingAgents系统_配置文件.json`文件
- [ ] **已保留** `config.example.py`模板文件
- [ ] **已保留** `期货TradingAgents系统_配置文件.example.json`模板文件
- [ ] **已验证** 模板文件中只有占位符，无真实密钥

运行检查命令：
```bash
# 搜索可能的API密钥
grep -r "sk-[a-zA-Z0-9]" TradingAgents_for_Futures/ --exclude-dir=.git

# 应该没有找到任何真实密钥
```

### 2. 配置文件检查

- [ ] `.gitignore`已正确配置
- [ ] `config.py`已添加到`.gitignore`
- [ ] `期货TradingAgents系统_配置文件.json`已添加到`.gitignore`
- [ ] `qihuo/config/core.yaml`已添加到`.gitignore`

验证命令：
```bash
# 检查.gitignore
cat TradingAgents_for_Futures/.gitignore | grep -E "config.py|配置文件.json"
```

### 3. 个人数据检查

- [ ] 删除个人分析结果
- [ ] 删除个人日志文件
- [ ] 删除测试输出文件
- [ ] 清空或删除缓存目录

运行清理：
```bash
cd TradingAgents_for_Futures

# 清理个人数据
rm -rf qihuo/output/*
rm -rf qihuo/logs/*.log
rm -rf qihuo/cache/*
rm -rf qihuo/analysis_results/*
rm -rf qihuo/debate_results/*
rm -rf qihuo/final_decisions/*
```

### 4. 数据库备份检查

- [ ] **已清空** `qihuo/database/backups/`目录
- [ ] **已保留** `.gitkeep`文件保持目录结构
- [ ] 数据库更新报告JSON文件已删除

```bash
# 清理备份
rm -rf TradingAgents_for_Futures/qihuo/database/backups/*
echo "# 保留此目录结构" > TradingAgents_for_Futures/qihuo/database/backups/.gitkeep
```

### 5. 临时文件检查

- [ ] 删除所有临时Python脚本（`temp_*.py`）
- [ ] 删除测试脚本（`test_*.py`）
- [ ] 删除调试脚本（`debug_*.py`）
- [ ] 删除Jupyter Notebook检查点

```bash
# 查找临时文件
find TradingAgents_for_Futures -name "temp_*.py"
find TradingAgents_for_Futures -name "test_*.py"
find TradingAgents_for_Futures -name ".ipynb_checkpoints"
```

### 6. 文档完整性检查

- [ ] README.md存在且完整
- [ ] API密钥配置指南存在
- [ ] 本地数据配置指南存在
- [ ] 快速开始指南存在
- [ ] LICENSE文件存在
- [ ] requirements.txt存在
- [ ] .gitignore存在

### 7. 示例数据检查

- [ ] 确认要上传哪些数据文件
- [ ] 数据文件大小合理（建议<100MB）
- [ ] 数据来自公开渠道
- [ ] 数据不包含个人信息

```bash
# 检查数据大小
du -sh TradingAgents_for_Futures/qihuo/database/
```

### 8. 绝对路径检查

- [ ] 配置文件使用相对路径
- [ ] 没有硬编码个人目录路径
- [ ] 路径使用跨平台兼容格式

搜索绝对路径：
```bash
# Windows路径
grep -r "D:/" TradingAgents_for_Futures/ --exclude-dir=.git
grep -r "C:/" TradingAgents_for_Futures/ --exclude-dir=.git

# Linux/Mac路径
grep -r "/Users/" TradingAgents_for_Futures/ --exclude-dir=.git
grep -r "/home/" TradingAgents_for_Futures/ --exclude-dir=.git
```

## 🔍 自动检查脚本

创建并运行检查脚本：

```python
# check_before_upload.py
import os
import re
from pathlib import Path

def check_sensitive_info():
    """检查敏感信息"""
    issues = []
    root = Path("TradingAgents_for_Futures")
    
    # 1. 检查API密钥
    if (root / "config.py").exists():
        issues.append("❌ config.py 存在（应删除）")
    
    if (root / "期货TradingAgents系统_配置文件.json").exists():
        issues.append("❌ 配置文件.json 存在（应删除）")
    
    # 2. 搜索API密钥模式
    for py_file in root.rglob("*.py"):
        if '.git' in str(py_file):
            continue
        content = py_file.read_text(encoding='utf-8', errors='ignore')
        if re.search(r'sk-[a-zA-Z0-9]{20,}', content):
            issues.append(f"⚠️ {py_file} 可能包含API密钥")
    
    # 3. 检查绝对路径
    for file in root.rglob("*.py"):
        if '.git' in str(file):
            continue
        content = file.read_text(encoding='utf-8', errors='ignore')
        if re.search(r'[CD]:\\', content) or '/Users/' in content or '/home/' in content:
            issues.append(f"⚠️ {file} 包含绝对路径")
    
    # 4. 输出结果
    if issues:
        print("发现以下问题：\n")
        for issue in issues:
            print(issue)
        return False
    else:
        print("✅ 所有检查通过！可以安全上传。")
        return True

if __name__ == "__main__":
    check_sensitive_info()
```

运行检查：
```bash
python check_before_upload.py
```

## 📤 上传步骤

所有检查通过后，执行以下步骤：

### 1. 初始化Git（如果还没有）

```bash
cd TradingAgents_for_Futures
git init
```

### 2. 添加文件

```bash
git add .
```

### 3. 检查即将提交的文件

```bash
# 查看将要提交的文件
git status

# 确认没有敏感文件
```

### 4. 提交

```bash
git commit -m "Initial commit: 商品期货AI分析系统"
```

### 5. 连接到GitHub

```bash
git remote add origin https://github.com/你的用户名/仓库名.git
git branch -M main
```

### 6. 推送

```bash
git push -u origin main
```

## ⚠️ 常见错误

### 错误1：不小心提交了API密钥

**解决方案**：
```bash
# 从历史记录中删除
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch config.py" \
  --prune-empty --tag-name-filter cat -- --all

# 强制推送
git push origin --force --all

# 立即更换API密钥！
```

### 错误2：提交了大文件

**解决方案**：
```bash
# 从暂存区移除
git rm --cached large_file.csv

# 添加到.gitignore
echo "large_file.csv" >> .gitignore

# 重新提交
git commit --amend
```

### 错误3：提交了个人数据

**解决方案**：
```bash
# 删除文件
git rm -r qihuo/output/

# 更新.gitignore
echo "qihuo/output/" >> .gitignore

# 提交更改
git commit -m "Remove personal data"
```

## 🔐 安全建议

1. **永远不要**将API密钥提交到公共仓库
2. **定期检查** `.gitignore`是否正确配置
3. **使用环境变量**而非配置文件存储密钥
4. **启用GitHub的secret scanning**检测泄露
5. **如果发现泄露**，立即更换所有密钥

## 📞 获取帮助

如果不确定某个文件是否应该上传：
1. 查看`.gitignore`规则
2. 询问有经验的开发者
3. 在GitHub Discussions提问
4. 宁可保守，不要冒险

## ✅ 最终确认

在执行`git push`之前，最后确认：

- [ ] 运行了`check_before_upload.py`检查脚本
- [ ] 手动检查了`git status`输出
- [ ] 确认没有个人敏感信息
- [ ] README.md准确描述了项目
- [ ] 所有文档都已更新
- [ ] LICENSE文件正确

**确认无误后，可以放心上传！**

---

**记住**：一旦推送到GitHub，数据就是公开的。上传前务必仔细检查！

