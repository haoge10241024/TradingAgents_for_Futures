# æœ¬åœ°æ•°æ®é…ç½®æŒ‡å—

## ğŸ“Š æ•°æ®è¯´æ˜

æœ¬ç³»ç»Ÿä½¿ç”¨æœ¬åœ°æ•°æ®åº“å­˜å‚¨æœŸè´§å†å²æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š
- åŸºå·®æ•°æ® (basis)
- åº“å­˜ä»“å•æ•°æ® (inventory & receipt)
- æŒä»“å¸­ä½æ•°æ® (positioning)
- æŠ€æœ¯åˆ†ææ•°æ® (technical_analysis)
- æœŸé™ç»“æ„æ•°æ® (term_structure)

## ğŸ—‚ï¸ æ•°æ®ç›®å½•ç»“æ„

```
qihuo/database/
â”œâ”€â”€ basis/              # åŸºå·®æ•°æ®ï¼ˆæœŸè´§-ç°è´§ä»·å·®ï¼‰
â”‚   â”œâ”€â”€ CU/            # é“œ
â”‚   â”œâ”€â”€ AL/            # é“
â”‚   â”œâ”€â”€ RB/            # èºçº¹é’¢
â”‚   â””â”€â”€ ...            # å…¶ä»–å“ç§
â”œâ”€â”€ inventory/          # åº“å­˜æ•°æ®
â”‚   â”œâ”€â”€ CU.csv
â”‚   â”œâ”€â”€ AL.csv
â”‚   â””â”€â”€ ...
â”œâ”€â”€ receipt/            # ä»“å•æ•°æ®
â”‚   â”œâ”€â”€ CU.csv
â”‚   â”œâ”€â”€ AL.csv
â”‚   â””â”€â”€ ...
â”œâ”€â”€ positioning/        # æŒä»“å¸­ä½æ•°æ®
â”‚   â”œâ”€â”€ CU/
â”‚   â”œâ”€â”€ AL/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ technical_analysis/ # æŠ€æœ¯åˆ†ææ•°æ®ï¼ˆKçº¿ã€æŒ‡æ ‡ç­‰ï¼‰
â”‚   â”œâ”€â”€ CU.csv
â”‚   â”œâ”€â”€ AL.csv
â”‚   â””â”€â”€ ...
â””â”€â”€ term_structure/     # æœŸé™ç»“æ„æ•°æ®
    â”œâ”€â”€ CU.csv
    â”œâ”€â”€ AL.csv
    â””â”€â”€ ...
```

## ğŸ”§ æ•°æ®è·¯å¾„é…ç½®

### æ–¹æ³•1ï¼šä½¿ç”¨é»˜è®¤ç›¸å¯¹è·¯å¾„ï¼ˆæ¨èï¼‰

ç³»ç»Ÿé»˜è®¤é…ç½®ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œæ— éœ€ä¿®æ”¹ï¼š

```json
// æœŸè´§TradingAgentsç³»ç»Ÿ_é…ç½®æ–‡ä»¶.json
{
  "paths": {
    "data_root_dir": "./qihuo/database",
    "results_dir": "./qihuo/trading_agents_results",
    "logs_dir": "./qihuo/logs",
    "cache_dir": "./qihuo/cache"
  }
}
```

è¿™ç§é…ç½®çš„ä¼˜ç‚¹ï¼š
- âœ… è·¨å¹³å°å…¼å®¹ï¼ˆWindows/macOS/Linuxï¼‰
- âœ… å¯éšé¡¹ç›®ç§»åŠ¨
- âœ… é€‚åˆGitHubåˆ†äº«

### æ–¹æ³•2ï¼šä½¿ç”¨ç»å¯¹è·¯å¾„

å¦‚æœéœ€è¦è‡ªå®šä¹‰æ•°æ®ä½ç½®ï¼š

```json
{
  "paths": {
    // Windowsç¤ºä¾‹
    "data_root_dir": "D:/æœŸè´§æ•°æ®/database",
    
    // macOS/Linuxç¤ºä¾‹
    "data_root_dir": "/Users/username/futures_data/database"
  }
}
```

**æ³¨æ„**ï¼šä½¿ç”¨ç»å¯¹è·¯å¾„æ—¶ï¼Œç¡®ä¿ï¼š
1. è·¯å¾„ä½¿ç”¨æ­£æ–œæ  `/` æˆ–åŒåæ–œæ  `\\`
2. è·¯å¾„ç¡®å®å­˜åœ¨
3. ç¨‹åºæœ‰è¯»å†™æƒé™

### æ–¹æ³•3ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡

æœ€çµæ´»çš„æ–¹å¼ï¼š

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export FUTURES_DATA_DIR="/path/to/data"
```

ç„¶ååœ¨é…ç½®ä¸­å¼•ç”¨ï¼š

```python
# config.py
import os
DATA_ROOT_DIR = os.getenv('FUTURES_DATA_DIR', './qihuo/database')
```

## ğŸ“¥ è·å–å†å²æ•°æ®

### é€‰é¡¹1ï¼šè‡ªåŠ¨ä¸‹è½½ï¼ˆæ¨èï¼‰

ç³»ç»Ÿå†…ç½®æ•°æ®ä¸‹è½½åŠŸèƒ½ï¼Œé¦–æ¬¡è¿è¡Œæ—¶è‡ªåŠ¨è·å–ï¼š

```bash
# è¿è¡Œæ•°æ®æ›´æ–°å™¨
python unified_futures_data_updater.py

# æˆ–åœ¨Streamlitç•Œé¢ä¸­ç‚¹å‡»"æ•°æ®æ›´æ–°"æŒ‰é’®
```

æ•°æ®æ¥æºï¼š
- **AkShare**ï¼šå…è´¹å¼€æºçš„é‡‘èæ•°æ®æ¥å£
- **äº¤æ˜“æ‰€å®˜ç½‘**ï¼šä¸ŠæœŸæ‰€ã€å¤§å•†æ‰€ã€éƒ‘å•†æ‰€ã€èƒ½æºä¸­å¿ƒ

ä¸‹è½½æ—¶é—´ï¼š
- é¦–æ¬¡å®Œæ•´ä¸‹è½½ï¼š10-30åˆ†é’Ÿ
- åç»­å¢é‡æ›´æ–°ï¼š2-5åˆ†é’Ÿ

### é€‰é¡¹2ï¼šä½¿ç”¨GitHubä¸Šçš„ç¤ºä¾‹æ•°æ®

æœ¬ä»“åº“åŒ…å«éƒ¨åˆ†ç¤ºä¾‹æ•°æ®ï¼Œå¯ç›´æ¥ä½¿ç”¨ï¼š

```bash
# å…‹éš†ä»“åº“åï¼Œæ•°æ®å·²åœ¨ qihuo/database/ ç›®å½•ä¸‹

# åŒ…å«çš„æ•°æ®ï¼š
- ä¸»è¦å“ç§çš„æœ€è¿‘90å¤©æ•°æ®
- åŸºå·®ã€åº“å­˜ã€æŒä»“ã€æŠ€æœ¯åˆ†æã€æœŸé™ç»“æ„
- çº¦10-15ä¸ªå¸¸ç”¨å“ç§
```

**ç¤ºä¾‹æ•°æ®ç‰¹ç‚¹**ï¼š
- âœ… å¼€ç®±å³ç”¨ï¼Œæ— éœ€ä¸‹è½½
- âœ… æ•°æ®å®Œæ•´ï¼Œå¯è¿è¡Œæ‰€æœ‰åˆ†æ
- âš ï¸ ä»…åŒ…å«è¿‘æœŸæ•°æ®ï¼ˆ90å¤©ï¼‰
- âš ï¸ ä¸åŒ…å«å…¨éƒ¨å“ç§

### é€‰é¡¹3ï¼šå¯¼å…¥è‡ªå·±çš„æ•°æ®

å¦‚æœæ‚¨æœ‰å†å²æ•°æ®ï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ ¼å¼å¯¼å…¥ï¼š

#### åŸºå·®æ•°æ®æ ¼å¼

```csv
date,futures_price,spot_price,basis,basis_rate
2024-01-01,50000,49500,-500,-0.01
2024-01-02,50100,49600,-500,-0.01
```

#### åº“å­˜æ•°æ®æ ¼å¼

```csv
date,inventory,change,change_rate
2024-01-01,100000,1000,0.01
2024-01-02,101000,1000,0.01
```

#### æŒä»“æ•°æ®æ ¼å¼

```csv
date,long_position,short_position,net_position
2024-01-01,100000,95000,5000
2024-01-02,102000,96000,6000
```

#### æŠ€æœ¯åˆ†ææ•°æ®æ ¼å¼

```csv
date,open,high,low,close,volume,amount
2024-01-01,50000,50500,49800,50200,100000,5010000000
```

å°†CSVæ–‡ä»¶æ”¾å…¥å¯¹åº”ç›®å½•å³å¯ã€‚

## ğŸ”„ æ•°æ®æ›´æ–°

### è‡ªåŠ¨æ›´æ–°

å»ºè®®æ¯å¤©ç›˜åæ›´æ–°æ•°æ®ï¼š

```bash
# æ‰‹åŠ¨è¿è¡Œ
python unified_futures_data_updater.py

# æˆ–ä½¿ç”¨è®¡åˆ’ä»»åŠ¡ï¼ˆLinux/macOSï¼‰
crontab -e
# æ·»åŠ ï¼šæ¯å¤©ä¸‹åˆ4ç‚¹æ›´æ–°
0 16 * * 1-5 cd /path/to/project && python unified_futures_data_updater.py
```

### å¢é‡æ›´æ–°

ç³»ç»Ÿæ™ºèƒ½è¯†åˆ«å·²æœ‰æ•°æ®ï¼Œåªä¸‹è½½æ–°æ•°æ®ï¼š

```python
# è‡ªåŠ¨å¢é‡æ›´æ–°
from modules import basis_updater, inventory_updater

# åªæ›´æ–°æœ€è¿‘7å¤©çš„æ•°æ®
updater.update_recent_data(days=7)
```

### æ•°æ®æ¸…ç†

å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®èŠ‚çœç©ºé—´ï¼š

```bash
# åªä¿ç•™æœ€è¿‘365å¤©çš„æ•°æ®
python qihuo/scripts/clean_old_data.py --days 365
```

## ğŸ“¤ æ•°æ®ä¸Šä¼ åˆ°GitHub

### å¯ä»¥ä¸Šä¼ çš„æ•°æ®

æœ¬é¡¹ç›®å·²é…ç½®`.gitignore`ï¼Œ**ç¤ºä¾‹æ•°æ®å¯ä»¥ä¸Šä¼ **ï¼š

```gitignore
# æ’é™¤ä¸ªäººæ•°æ®å’Œç¼“å­˜
qihuo/database/backups/     # å¤‡ä»½æ–‡ä»¶ä¸ä¸Šä¼ 
qihuo/database/cache/       # ç¼“å­˜ä¸ä¸Šä¼ 
qihuo/database/*.json       # ä¸´æ—¶JSONä¸ä¸Šä¼ 

# å…è®¸ä¸Šä¼ CSVæ•°æ®æ–‡ä»¶
!qihuo/database/**/*.csv
```

**å»ºè®®ä¸Šä¼ çš„æ•°æ®**ï¼š
- âœ… ä¸»è¦å“ç§çš„90å¤©æ•°æ®
- âœ… æ•°æ®ç»“æ„ç¤ºä¾‹
- âœ… æµ‹è¯•ç”¨æ•°æ®

**ä¸å»ºè®®ä¸Šä¼ çš„æ•°æ®**ï¼š
- âŒ å®Œæ•´å†å²æ•°æ®ï¼ˆæ–‡ä»¶è¿‡å¤§ï¼‰
- âŒ ä¸ªäººåˆ†æç»“æœ
- âŒ å¤‡ä»½æ–‡ä»¶

### æ•°æ®ä¸Šä¼ æ­¥éª¤

```bash
# 1. å‡†å¤‡ç¤ºä¾‹æ•°æ®ï¼ˆåªä¿ç•™éƒ¨åˆ†ï¼‰
python scripts/prepare_sample_data.py

# 2. æ£€æŸ¥æ•°æ®å¤§å°
du -sh qihuo/database/

# 3. å¦‚æœå°äº100MBï¼Œå¯ä»¥ä¸Šä¼ 
git add qihuo/database/
git commit -m "Add sample futures data"
git push
```

### å¤§æ–‡ä»¶å¤„ç†

å¦‚æœæ•°æ®è¶…è¿‡100MBï¼Œä½¿ç”¨Git LFSï¼š

```bash
# å®‰è£…Git LFS
git lfs install

# è¿½è¸ªå¤§å‹CSVæ–‡ä»¶
git lfs track "qihuo/database/**/*.csv"

# æäº¤
git add .gitattributes
git add qihuo/database/
git commit -m "Add data with LFS"
git push
```

## âœ… éªŒè¯æ•°æ®

### æ£€æŸ¥æ•°æ®å®Œæ•´æ€§

```python
# è¿è¡ŒéªŒè¯è„šæœ¬
python qihuo/scripts/diagnose_data.py

# è¾“å‡ºç¤ºä¾‹ï¼š
# âœ“ åŸºå·®æ•°æ®: 45/52 å“ç§å®Œæ•´
# âœ“ åº“å­˜æ•°æ®: 38/52 å“ç§å®Œæ•´
# âœ“ æŒä»“æ•°æ®: 52/52 å“ç§å®Œæ•´
# âœ“ æŠ€æœ¯æ•°æ®: 52/52 å“ç§å®Œæ•´
```

### æŸ¥çœ‹æ•°æ®çŠ¶æ€

åœ¨Streamlitç•Œé¢ä¸­ï¼š
1. ç‚¹å‡»ä¾§è¾¹æ "æ•°æ®çŠ¶æ€"
2. æŸ¥çœ‹å„å“ç§æ•°æ®è¦†ç›–æƒ…å†µ
3. ç‚¹å‡»"åˆ·æ–°"æ›´æ–°çŠ¶æ€

## ğŸ› ï¸ æ•°æ®é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šæ‰¾ä¸åˆ°æ•°æ®æ–‡ä»¶

**ç—‡çŠ¶**ï¼š`FileNotFoundError: [Errno 2] No such file or directory`

**è§£å†³**ï¼š
```bash
# 1. æ£€æŸ¥è·¯å¾„é…ç½®
# 2. ç¡®ä¿æ•°æ®ç›®å½•å­˜åœ¨
mkdir -p qihuo/database/{basis,inventory,positioning,technical_analysis,term_structure}

# 3. è¿è¡Œæ•°æ®ä¸‹è½½
python unified_futures_data_updater.py
```

### é—®é¢˜2ï¼šæ•°æ®æ ¼å¼é”™è¯¯

**ç—‡çŠ¶**ï¼š`ValueError: could not convert string to float`

**è§£å†³**ï¼š
```python
# æ£€æŸ¥CSVæ–‡ä»¶ç¼–ç å’Œæ ¼å¼
import pandas as pd
df = pd.read_csv('qihuo/database/inventory/CU.csv', encoding='utf-8')
print(df.head())
print(df.dtypes)
```

### é—®é¢˜3ï¼šæ•°æ®æ›´æ–°å¤±è´¥

**ç—‡çŠ¶**ï¼šAPIè¯·æ±‚è¶…æ—¶æˆ–å¤±è´¥

**è§£å†³**ï¼š
```bash
# 1. æ£€æŸ¥ç½‘ç»œè¿æ¥
ping akshare.pro

# 2. ä½¿ç”¨ä»£ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰
export HTTP_PROXY=http://proxy.example.com:8080

# 3. å‡å°å¹¶å‘æ•°
# åœ¨é…ç½®ä¸­è®¾ç½®ï¼š
"max_concurrent_processes": 2
```

### é—®é¢˜4ï¼šæ•°æ®å ç”¨ç©ºé—´å¤§

**ç—‡çŠ¶**ï¼šç£ç›˜ç©ºé—´ä¸è¶³

**è§£å†³**ï¼š
```bash
# 1. æŸ¥çœ‹æ•°æ®å¤§å°
du -sh qihuo/database/*

# 2. æ¸…ç†å¤‡ä»½æ–‡ä»¶
rm -rf qihuo/database/backups/*

# 3. åªä¿ç•™å¿…è¦å“ç§
python scripts/keep_essential_commodities.py
```

## ğŸ“Š æ•°æ®è´¨é‡

### æ•°æ®æ¥æºå¯é æ€§

| æ•°æ®ç±»å‹ | æ¥æº | å»¶è¿Ÿ | å¯é æ€§ |
|---------|------|------|--------|
| æŠ€æœ¯æ•°æ® | AkShare | T+0 | â­â­â­â­â­ |
| åº“å­˜æ•°æ® | äº¤æ˜“æ‰€å®˜ç½‘ | T+1 | â­â­â­â­â­ |
| æŒä»“æ•°æ® | äº¤æ˜“æ‰€å®˜ç½‘ | T+1 | â­â­â­â­â­ |
| åŸºå·®æ•°æ® | è®¡ç®—å¾—å‡º | T+1 | â­â­â­â­ |
| æ–°é—»æ•°æ® | å¤šæºèšåˆ | å®æ—¶ | â­â­â­â­ |

### æ•°æ®æ›´æ–°é¢‘ç‡

- **æ—¥å†…æ•°æ®**ï¼šæ¯å°æ—¶æ›´æ–°ï¼ˆæœŸè´§äº¤æ˜“æ—¶æ®µï¼‰
- **æ—¥çº¿æ•°æ®**ï¼šæ¯æ—¥æ”¶ç›˜åæ›´æ–°
- **å‘¨åº¦æ•°æ®**ï¼šæ¯å‘¨äº”æ›´æ–°
- **æœˆåº¦æ•°æ®**ï¼šæ¯æœˆæœ«æ›´æ–°

## ğŸ”— ç›¸å…³è„šæœ¬

```bash
# æ•°æ®æ›´æ–°
python unified_futures_data_updater.py

# æ•°æ®è¯Šæ–­
python qihuo/scripts/diagnose_data.py

# å¯¼å‡ºæ•°æ®
python qihuo/scripts/export_inventory.py

# æ„å»ºæ•°æ®åº“
python qihuo/scripts/build_inventory_database.py
```

## ğŸ“š ä¸‹ä¸€æ­¥

é…ç½®å®Œæ•°æ®åï¼š
1. é˜…è¯» [å¿«é€Ÿå¼€å§‹æŒ‡å—](å¿«é€Ÿå¼€å§‹æŒ‡å—.md)
2. è¿è¡Œç³»ç»Ÿæµ‹è¯•åˆ†æ
3. æŸ¥çœ‹ [ä½¿ç”¨æ–‡æ¡£](README.md)

---

**æç¤º**ï¼šå¦‚æœé‡åˆ°æ•°æ®é—®é¢˜ï¼Œè¯·å…ˆæŸ¥çœ‹ `qihuo/logs/` ä¸‹çš„æ—¥å¿—æ–‡ä»¶ã€‚

